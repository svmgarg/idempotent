<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idempotency Service - API Documentation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üîí</text></svg>">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a class="logo" href="#">Idempotency Service</a>
            <button class="sidebar-toggle d-lg-none" id="sidebarToggle" title="Close">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
        <nav class="sidebar-nav">
            <h5 class="nav-section-title">Documentation</h5>
            <ul class="nav-list">
                <li><a href="#overview" class="nav-link-sidebar">Overview</a></li>
                <li><a href="#use-cases" class="nav-link-sidebar">Use Cases</a></li>
            </ul>

            <h5 class="nav-section-title">Integration</h5>
            <ul class="nav-list">
                <li><a href="#zapier" class="nav-link-sidebar">Zapier</a></li>
            </ul>

            <h5 class="nav-section-title">API</h5>
            <ul class="nav-list">
                <li><a href="#authentication" class="nav-link-sidebar">Authentication</a></li>
                <li><a href="#check-api" class="nav-link-sidebar">Check API</a></li>
                <li><a href="#health-api" class="nav-link-sidebar">Health API</a></li>
            </ul>

            <h5 class="nav-section-title">Resources</h5>
            <ul class="nav-list">
                <li><a href="#examples" class="nav-link-sidebar">Examples</a></li>
                <li><a href="#tester" class="nav-link-sidebar">API Tester</a></li>
                <li><a href="#faq" class="nav-link-sidebar">FAQ</a></li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Content Area (SPA - One section at a time) -->
        <div class="content-area">
            <!-- Overview Section -->
            <section class="page" data-page="overview">
                <h2>Overview</h2>
                <p class="lead">The Idempotency Service is your safety net against duplicate triggers.</p>
                <p>In distributed systems, the same request can arrive multiple times due to network failures, user retries, automation tool retries, or client-side issues. Without idempotency, this means the same operation gets executed multiple times‚Äîresulting in duplicate charges, double-booked seats, duplicate orders, or duplicate notifications.</p>
                
                <h3>How It Works</h3>
                <div class="info-block">
                    <p><strong class="flow-title">1. First Request</strong> ‚Äî Your app calls <code>/check</code> with a unique ID ‚Üí Returns <code>isDuplicate: false</code></p>
                    <p><strong class="flow-title">2. Process</strong> ‚Äî Your app executes the operation (payment, order, etc.) and caches the result</p>
                    <p><strong class="flow-title">3. Duplicate Request</strong> ‚Äî Same ID arrives again ‚Üí Calls <code>/check</code> ‚Üí Returns <code>isDuplicate: true</code></p>
                </div>

                <h3>Base URL</h3>
                <pre><code>http://144.24.119.46/api/idempotency</code></pre>
            </section>

            <!-- Real-World Scenarios Section -->
            <section class="page" data-page="use-cases">
                <h2>Real-World Scenarios</h2>
                <p>Here are common situations where duplicate triggers occur and how this service helps:</p>

                <div class="use-case">
                    <h3>1. Order Creation (Most Common)</h3>
                    <p><strong>Scenario:</strong> A user clicks "Place Order" twice or the client retries due to a timeout.</p>
                    <p><strong>Without idempotency:</strong> Two orders can be created, customer may be charged twice.</p>
                    <p><strong>With idempotency:</strong> Only the first request is processed and all retries return the same response.</p>
                </div>

                <div class="use-case">
                    <h3>2. Payment Capture / Payment Processing</h3>
                    <p><strong>Scenario:</strong> Payment API is retried due to double click or client retry for an order.</p>
                    <p><strong>Without idempotency:</strong> Payment can be captured multiple times.</p>
                    <p><strong>With idempotency:</strong> Payment is executed only once and retries return the original payment result.</p>
                </div>

                <div class="use-case">
                    <h3>3. Inventory Reservation / Stock Deduction</h3>
                    <p><strong>Scenario:</strong> Inventory reserve/deduct call is retried due to application crash or client retry.</p>
                    <p><strong>Without idempotency:</strong> Stock may be reduced multiple times causing incorrect inventory.</p>
                    <p><strong>With idempotency:</strong> Stock is deducted only once.</p>
                </div>

                <div class="use-case">
                    <h3>4. Webhook Processing (Stripe / Razorpay / PayPal / Zapier)</h3>
                    <p><strong>Scenario:</strong> Webhook providers retry the same webhook event multiple times.</p>
                    <p><strong>Without idempotency:</strong> Duplicate invoice generation / duplicate order update / duplicate notifications.</p>
                    <p><strong>With idempotency:</strong> Use webhook eventId as key and process each event exactly once.</p>
                </div>

                <div class="use-case">
                    <h3>5. Invoice Generation / Document Generation</h3>
                    <p><strong>Scenario:</strong> Invoice generation is retried due to failure or retry policy.</p>
                    <p><strong>Without idempotency:</strong> Multiple invoices can be created for the same order.</p>
                    <p><strong>With idempotency:</strong> Invoice is generated only once.</p>
                </div>

                <div class="use-case">
                    <h3>6. Notification / Email / SMS Sending</h3>
                    <p><strong>Scenario:</strong> Notification send is retried due to network issues.</p>
                    <p><strong>Without idempotency:</strong> User receives duplicate emails/SMS.</p>
                    <p><strong>With idempotency:</strong> Only one notification is sent per unique key.</p>
                </div>

                <div class="use-case">
                    <h3>7. Zapier Integration (Automation Safety)</h3>
                    <p><strong>Scenario:</strong> Zapier workflows may trigger twice or retry because of network failures / step failures / replay.</p>
                    <p><strong>Without idempotency:</strong> Duplicate CRM updates, duplicate Slack messages, duplicate payments.</p>
                    <p><strong>With idempotency:</strong> Zapier sends a stable idempotency key and your service blocks duplicate execution.</p>
                </div>
            </section>

            <!-- Zapier Section -->
            <section class="page" data-page="zapier">
                <h2>Zapier Integration</h2>
                <p class="lead">Integrate the Idempotency Service with Zapier workflows to prevent duplicate actions.</p>
                <p>Zapier can retry actions due to network failures or step failures. Use the Idempotency integration to ensure each action executes exactly once, even if retried multiple times.</p>

                <div class="info-block" style="display: flex; align-items: flex-start; gap: 0.75rem; background: #fff3cd; border-left: 4px solid #ffc107;">
                    <span style="font-size: 1.1rem;">‚ö†Ô∏è</span>
                    <span><strong>Important:</strong> The Idempotency Service is <strong>not</strong> to handle retries. It is designed to <strong>identify duplicate triggers</strong>. Your Zap remains responsible for managing retries. The service simply tells you if a request is new or a duplicate, so you can skip processing if needed.</span>
                </div>

                <hr>
                <h3>Setup Steps</h3>
                <div class="info-block">
                    <p><strong class="flow-title">1. Create a New Zap</strong> ‚Äî Start building a Zap in your Zapier workspace</p>
                    <p><strong class="flow-title">2. Add Trigger</strong> ‚Äî Choose your trigger (e.g., webhook, schedule, form submission)</p>
                    <p><strong class="flow-title">3. Add Action</strong> ‚Äî Search for "Idempotency" integration and select the "Check Idempotency" action</p>
                    <p><strong class="flow-title">4. Configure Authentication</strong> ‚Äî Provide your API Key when prompted</p>
                    <p><strong class="flow-title">5. Map Idempotency Key</strong> ‚Äî Set the Idempotency Key field (see examples below)</p>
                    <p><strong class="flow-title">6. Conditional Logic</strong> ‚Äî Use the response to branch: If duplicate ‚Üí skip, if new ‚Üí execute next step</p>
                </div>

                <hr>
                <h3>Check Idempotency Action</h3>
                <div class="content-block">
                    <p>The "Check Idempotency" action atomically checks if a key has been seen before and registers new keys for future tracking.</p>

                <div class="zapier-content-block">
                    <h4 class="zapier-sub-heading">Input</h4>
                    <div class="param-list">
                        <div class="param-item">
                            <div class="param-header">
                                <code>Idempotency Key</code>
                                <span class="param-type">string (required)</span>
                            </div>
                            <p class="param-desc">Unique identifier for this action. Max 64 characters. Examples: webhook event ID, user ID + action combo, order ID, etc.</p>
                        </div>
                    </div>

                    <h4 class="zapier-sub-heading">Output</h4>
                    <p>The action returns the following fields (for more details, refer to the <a href="#check-api" onclick="showPage('check-api'); return false;" class="email-link">Check API section</a>):</p>
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>isDuplicate</code></td>
                                <td>boolean</td>
                                <td><code>true</code> = key already seen (skip execution), <code>false</code> = first time (proceed)</td>
                            </tr>
                            <tr>
                                <td><code>idempotencyKey</code></td>
                                <td>string</td>
                                <td>The key you submitted</td>
                            </tr>
                            <tr>
                                <td><code>createdAt</code></td>
                                <td>timestamp</td>
                                <td>When the key was first registered (ISO 8601 format)</td>
                            </tr>
                            <tr>
                                <td><code>expiresAt</code></td>
                                <td>timestamp</td>
                                <td>When the key expires and will no longer be tracked</td>
                            </tr>
                            <tr>
                                <td><code>resultStatusCode</code></td>
                                <td>number</td>
                                <td>HTTP status code: 200 (success), 400 (validation error), 401 (auth error)</td>
                            </tr>
                            <tr>
                                <td><code>message</code></td>
                                <td>string</td>
                                <td>Human-readable status or error message</td>
                            </tr>
                            <tr>
                                <td><code>processingTimeNanos</code></td>
                                <td>number</td>
                                <td>Processing time in nanoseconds (for performance tracking)</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4 class="zapier-sub-heading">Example Response</h4>
                    <pre><code>{
  "isDuplicate": false,
  "idempotencyKey": "webhook-stripe-evt-123",
  "createdAt": "2026-02-07T09:53:36.894236031Z",
  "expiresAt": "2026-02-07T10:53:36.894236031Z",
  "resultStatusCode": 200,
  "message": "Success",
  "processingTimeNanos": 12500
}</code></pre>
                </div>
                </div>
                

                <hr>
                <h3>Workflow Pattern</h3>
                <div class="content-block">
                    <p>Typical flow in your Zapier Zap:</p>
                    <p><strong class="flow-title">1.</strong> Trigger fires (webhook, schedule, form, etc.)</p>
                    <p><strong class="flow-title">2.</strong> Call "Check Idempotency" action with unique key</p>
                    <p><strong class="flow-title">3.</strong> Check result:</p>
                    <p style="margin-left: 2rem;">‚Ä¢ <strong>If isDuplicate = false</strong> ‚Üí Action is new, proceed to next steps (create order, send email, update CRM, etc.)</p>
                    <p style="margin-left: 2rem;">‚Ä¢ <strong>If isDuplicate = true</strong> ‚Üí Action already processed, skip remaining steps or branch to notification action</p>
                </div>

                <hr>
                <h3>Zapier Use Cases</h3>

                <div class="content-block">
                    <div class="zapier-use-case">
                        <h4>Webhook Events (Stripe, PayPal, etc.)</h4>
                        <p><strong>Scenario:</strong> Payment providers send webhook events that may be delivered multiple times due to system issues.</p>
                        <p><strong>Solution:</strong> Use webhook event ID as idempotency key to detect and skip duplicate events:</p>
                        <pre><code>Idempotency Key = Webhook Event ID (e.g., evt_stripe_1A2B3C)</code></pre>
                    </div>

                    <div class="zapier-use-case">
                        <h4>Form Submissions</h4>
                        <p><strong>Scenario:</strong> Users submit forms multiple times (accidental double-clicks, page refreshes, etc.).</p>
                        <p><strong>Solution:</strong> Use user ID + form submission identifier to detect duplicates:</p>
                        <pre><code>Idempotency Key = user_789_form_lead_2026-02-07</code></pre>
                    </div>

                    <div class="content-block" style="display: flex; align-items: flex-start; gap: 0.75rem; background: #e7f3ff; border-left: 4px solid #667eea;">
                        <span style="font-size: 1.1rem; color: #667eea;" title="More information available">‚ÑπÔ∏è</span>
                        <span>For more detailed scenarios including orders, payments, inventory, invoices, notifications, and more, visit the <a href="#use-cases" onclick="showPage('use-cases'); return false;" class="email-link">Use Cases page</a>.</span>
                    </div>
                </div>

                <hr>
                <h3>How to Generate a Good Idempotency Key</h3>
                <p>Choose a unique combination that identifies the operation:</p>
                <div class="status-list">
                    <div class="status-item">
                        <span class="status-code success">‚úì Good</span>
                        <span class="status-desc">Webhook event ID: <code>evt_stripe_12345</code></span>
                    </div>
                    <div class="status-item">
                        <span class="status-code success">‚úì Good</span>
                        <span class="status-desc">User + Action: <code>user_789_create_order</code></span>
                    </div>
                    <div class="status-item">
                        <span class="status-code success">‚úì Good</span>
                        <span class="status-desc">Order ID: <code>order_2026020799999</code></span>
                    </div>
                    <div class="status-item">
                        <span class="status-code danger">‚úó Avoid</span>
                        <span class="status-desc">Timestamps only: <code>2026-02-07T09:53:36Z</code> (not unique across retries)</span>
                    </div>
                    <div class="status-item">
                        <span class="status-code danger">‚úó Avoid</span>
                        <span class="status-desc">Empty or duplicate keys across different requests</span>
                    </div>
                </div>

                <hr>
                <h3>Authentication</h3>
                <p>When you add the "Check Idempotency" action, Zapier will prompt for your API Key. Provide the API Key you received from us. This authenticates all requests to the Idempotency Service.</p>
                <p>Don't have an API Key? <a href="#authentication" onclick="showPage('authentication'); return false;" class="email-link">Request one here</a>.</p>
            </section>

            <!-- Authentication Section -->
            <section class="page" data-page="authentication">
                <h2>Authentication</h2>
                <p class="lead">All API endpoints require API Key authentication, except <code>/ping</code>.</p>

                <h3>Request Header</h3>
                <div class="section-card">
                    <div class="header-row">
                        <span class="header-name"><code>X-API-KEY</code></span>
                        <span class="header-value">Your assigned API key</span>
                        <span class="badge bg-danger">Required</span>
                    </div>
                </div>

                <h3>How to Get an API Key</h3>
                <p>Email <a href="mailto:svmgarg@gmail.com?subject=API%20Key%20Request%20for%20Idempotency%20Service&body=Hi,%0A%0AI%20would%20like%20to%20request%20an%20API%20key%20for%20the%20Idempotency%20Service.%0A%0AName%20%2F%20Organization:%0AUse%20Case:%0AExpected%20Volume:%0A%0AThank%20you" class="email-link">svmgarg@gmail.com</a> with the following details:</p>
                <div class="info-block">
                    <p><strong class="flow-title">1.</strong> Your name or organization</p>
                    <p><strong class="flow-title">2.</strong> Use case for the API</p>
                    <p><strong class="flow-title">3.</strong> Expected request volume</p>
                </div>
            </section>

            <!-- Check API Section -->
            <section class="page" data-page="check-api">
                <h2>Check API</h2>
                <p class="lead">Atomically checks if an idempotency key exists and inserts it if not found.</p>

                <div class="endpoint-card">
                    <div class="endpoint-header">
                        <span class="method post">POST</span>
                        <code>/api/idempotency/check</code>
                        <span class="badge bg-danger ms-auto">Auth Required</span>
                    </div>
                </div>

                <div class="api-section">
                    <h3>Request Body</h3>
                    <div class="param-list">
                        <div class="param-item">
                            <div class="param-header">
                                <code>idempotencyKey</code>
                                <span class="param-type">string</span>
                                <span class="badge bg-danger">Required</span>
                            </div>
                            <p class="param-desc">Unique key to identify the operation. Max 64 characters.</p>
                        </div>
                        <div class="param-item">
                            <div class="param-header">
                                <code>clientId</code>
                                <span class="param-type">string</span>
                                <span class="badge bg-secondary">Optional</span>
                            </div>
                            <p class="param-desc">Client identifier for multi-tenant scenarios. Max 64 characters.</p>
                        </div>
                        <div class="param-item">
                            <div class="param-header">
                                <code>ttlSeconds</code>
                                <span class="param-type">long</span>
                                <span class="badge bg-secondary">Optional</span>
                            </div>
                            <p class="param-desc">Custom TTL in seconds. Default: 3600. Max: 3600 (1 hour).</p>
                        </div>
                    </div>
                </div>

                <div class="api-section">
                    <h3>Example Request</h3>
                    <pre><code>POST /api/idempotency/check
Content-Type: application/json
X-API-KEY: your-api-key-here

{
  "idempotencyKey": "payment-123",
  "ttlSeconds": 3600
}</code></pre>
                </div>

                <div class="api-section">


                    <h3>Possible Responses</h3>
                    <div class="accordion" id="responseAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#respNew">
                                    New Key (First Request)
                                </button>
                            </h2>
                            <div id="respNew" class="accordion-collapse collapse show" data-bs-parent="#responseAccordion">
                                <div class="accordion-body">
                                    <pre><code>{
  "idempotencyKey": "payment-123",
  "isDuplicate": false,
  "createdAt": "2026-02-07T12:00:00Z",
  "expiresAt": "2026-02-07T13:00:00Z",
  "processingTimeNanos": 12500
}</code></pre>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#respDup">
                                    Duplicate Key (Retry)
                                </button>
                            </h2>
                            <div id="respDup" class="accordion-collapse collapse" data-bs-parent="#responseAccordion">
                                <div class="accordion-body">
                                    <pre><code>{
  "idempotencyKey": "payment-123",
  "isDuplicate": true,
  "createdAt": "2026-02-07T12:00:00Z",
  "expiresAt": "2026-02-07T13:00:00Z",
  "processingTimeNanos": 8200
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="api-section">
                    <h3>Error Responses</h3>
                    <div class="accordion" id="errorAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#errLength">
                                    Invalid Key Length
                                </button>
                            </h2>
                            <div id="errLength" class="accordion-collapse collapse" data-bs-parent="#errorAccordion">
                                <div class="accordion-body">
                                    <pre><code>{
  "resultStatusCode": 400,
  "isDuplicate": false,
  "error": "idempotencyKey exceeds maximum length of 64 characters"
}</code></pre>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#errTtl">
                                    TTL Exceeds Maximum
                                </button>
                            </h2>
                            <div id="errTtl" class="accordion-collapse collapse" data-bs-parent="#errorAccordion">
                                <div class="accordion-body">
                                    <pre><code>{
  "resultStatusCode": 400,
  "isDuplicate": false,
  "error": "ttlSeconds cannot exceed 3600 seconds (1 hour)"
}</code></pre>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#errMissing">
                                    Missing Key
                                </button>
                            </h2>
                            <div id="errMissing" class="accordion-collapse collapse" data-bs-parent="#errorAccordion">
                                <div class="accordion-body">
                                    <pre><code>{
  "resultStatusCode": 400,
  "isDuplicate": false,
  "error": "idempotencyKey is required and cannot be empty"
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="api-section">
                    <h3>Response Behavior</h3>
                    <p>All responses return HTTP 200 OK. Check <code>resultStatusCode</code> in body for actual status.</p>
                    
                    <div class="status-list">
                        <div class="status-item">
                            <span class="status-code success">200</span>
                            <span class="status-desc">Successful check (new or duplicate)</span>
                        </div>
                        <div class="status-item">
                            <span class="status-code warning">400</span>
                            <span class="status-desc">Invalid request or validation error</span>
                        </div>
                        <div class="status-item">
                            <span class="status-code danger">401</span>
                            <span class="status-desc">Missing or invalid API key</span>
                        </div>
                        <div class="status-item">
                            <span class="status-code danger">500</span>
                            <span class="status-desc">Server error</span>
                        </div>
                    </div>

                    <div class="note-box" style="margin-top: 1.5rem;">
                        <strong>Decision Logic:</strong> Check the <code>isDuplicate</code> field. If <code>false</code>, proceed with your operation. If <code>true</code>, skip (already processed).
                    </div>
                </div>
            </section>

            <!-- Health API Section -->
            <section class="page" data-page="health-api">
                <h2>Health & Monitoring</h2>
                <p class="lead">Endpoints to verify service availability.</p>

                <div class="endpoint-list">
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/idempotency/health</code>
                            <span class="badge bg-danger ms-auto">Auth Required</span>
                        </div>
                        <p class="endpoint-desc">Full health check with service status details.</p>
                    </div>

                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/ping</code>
                            <span class="badge bg-success ms-auto">Public</span>
                        </div>
                        <p class="endpoint-desc">Simple ping endpoint. Returns <code>PONG</code> if service is up.</p>
                    </div>
                </div>
            </section>

            <!-- Examples Section -->
            <section class="page" data-page="examples">
                <h2>Code Examples</h2>
                <p class="lead">Integration examples in popular languages.</p>

                <div class="example-list">
                    <div class="example-item">
                        <h3>cURL</h3>
                        <div class="code-block">
                            <button class="btn btn-sm btn-outline-light copy-btn" title="Copy to clipboard">Copy</button>
                            <pre><code>curl -X POST http://144.24.119.46/api/idempotency/check \
  -H "Content-Type: application/json" \
  -H "X-API-KEY: your-api-key" \
  -d '{
    "idempotencyKey": "order-12345",
    "ttlSeconds": 3600
  }'</code></pre>
                        </div>
                    </div>

                    <div class="example-item">
                        <h3>JavaScript</h3>
                        <div class="code-block">
                            <button class="btn btn-sm btn-outline-light copy-btn" title="Copy to clipboard">Copy</button>
                            <pre><code>fetch('http://144.24.119.46/api/idempotency/check', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-API-KEY': 'your-api-key'
  },
  body: JSON.stringify({
    idempotencyKey: 'order-12345',
    ttlSeconds: 3600
  })
}).then(r => r.json()).then(data => {
  if (data.isDuplicate) {
    console.log('Duplicate - skip operation');
  } else {
    console.log('New request - proceed');
  }
});</code></pre>
                        </div>
                    </div>

                    <div class="example-item">
                        <h3>Python</h3>
                        <div class="code-block">
                            <button class="btn btn-sm btn-outline-light copy-btn" title="Copy to clipboard">Copy</button>
                            <pre><code>import requests

response = requests.post(
    'http://144.24.119.46/api/idempotency/check',
    headers={'X-API-KEY': 'your-api-key'},
    json={
        'idempotencyKey': 'order-12345',
        'ttlSeconds': 3600
    }
)

if response.json()['isDuplicate']:
    print('Duplicate - skip operation')
else:
    print('New request - proceed')</code></pre>
                        </div>
                    </div>
                </div>
            </section>

            <!-- API Tester Section -->
            <section class="page" data-page="tester">
                <h2>Interactive API Tester</h2>
                <p class="lead">Test the Idempotency Check API directly from this page.</p>

                <div class="endpoint">
                    <form id="testerForm" class="row g-3">
                        <div class="col-md-6">
                            <label for="apiKey" class="form-label"><strong>API Key</strong></label>
                            <input type="text" class="form-control" id="apiKey" placeholder="your-api-key" value="demo-key-123">
                        </div>
                        <div class="col-md-6">
                            <label for="idempotencyKey" class="form-label"><strong>Idempotency Key</strong></label>
                            <input type="text" class="form-control" id="idempotencyKey" placeholder="e.g., order-123" value="">
                        </div>
                        <div class="col-md-6">
                            <label for="ttlSeconds" class="form-label"><strong>TTL Seconds</strong></label>
                            <input type="number" class="form-control" id="ttlSeconds" placeholder="3600" value="3600" min="1" max="3600">
                        </div>
                        <div class="col-md-6 d-flex align-items-end">
                            <button type="button" class="btn btn-primary w-100" id="testBtn">Test API</button>
                        </div>
                    </form>

                    <div id="testerResult" style="display: none; margin-top: 20px;">
                        <h4>Response</h4>
                        <pre id="resultJson"><code>Waiting for response...</code></pre>
                        <button class="btn btn-sm btn-outline-secondary" id="copyResultBtn">Copy Response</button>
                    </div>

                    <div id="testerError" style="display: none; margin-top: 20px;" class="alert alert-danger"></div>
                    <div id="testerLoading" style="display: none; margin-top: 20px;" class="alert alert-info">
                        <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                        Testing API...
                    </div>
                </div>
            </section>

            <!-- FAQ Section -->
            <section class="page" data-page="faq">
                <h2>Frequently Asked Questions</h2>
                <p class="lead">Common questions about the Idempotency Service.</p>

                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                What happens if I don't call the service?
                            </button>
                        </h2>
                        <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Without idempotency checks, duplicate requests will execute your operation multiple times. This can result in duplicate charges, multiple orders, or repeated notifications.
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                How long should I set the TTL?
                            </button>
                        </h2>
                        <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                TTL (Time-To-Live) depends on your use case: 
                                <ul>
                                    <li><strong>Orders/Payments:</strong> 1-6 hours (3600-21600 seconds)</li>
                                    <li><strong>Quick operations:</strong> 5-10 minutes (300-600 seconds)</li>
                                    <li><strong>Webhooks:</strong> Match your webhook retry timeout (usually 24-48 hours)</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                What if the service is down?
                            </button>
                        </h2>
                        <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                If the service is unavailable, you should fail-safe by either:
                                <ul>
                                    <li>Retry your operation after service recovery</li>
                                    <li>Use local caching as a fallback</li>
                                    <li>Implement exponential backoff before retrying</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                                Can I use any string as the idempotency key?
                            </button>
                        </h2>
                        <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Yes, any string 1-64 characters long works. Best practices:
                                <ul>
                                    <li><code>UUID</code> - Best for uniqueness</li>
                                    <li><code>order-ID</code> - Descriptive</li>
                                    <li><code>user-123-action-456</code> - More context</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq5">
                                What's the performance overhead?
                            </button>
                        </h2>
                        <div id="faq5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Each check takes <strong>&lt;15ms</strong> on average:
                                <ul>
                                    <li>First request (new key): ~10-15ms</li>
                                    <li>Duplicate request (existing key): ~5-10ms</li>
                                    <li>Response includes processing time in nanoseconds for detailed metrics</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq6">
                                How do I generate a good idempotency key?
                            </button>
                        </h2>
                        <div id="faq6" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Use a combination that uniquely identifies the operation:
                                <pre><code>// Good examples:
const key = `user-${userId}-order-${Date.now()}`;  // Descriptive + timestamp
const key = crypto.randomUUID();                     // Pure uniqueness
const key = `${userId}-${orderId}`;                 // User + order combo</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Copy to clipboard functionality
        document.querySelectorAll('.copy-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const codeBlock = this.nextElementSibling;
                const code = codeBlock.textContent;
                navigator.clipboard.writeText(code).then(() => {
                    const originalText = this.textContent;
                    this.textContent = 'Copied!';
                    this.classList.add('copied');
                    setTimeout(() => {
                        this.textContent = originalText;
                        this.classList.remove('copied');
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy:', err);
                    this.textContent = 'Failed';
                    setTimeout(() => {
                        this.textContent = 'Copy';
                    }, 2000);
                });
            });
        });

        // API Tester functionality
        document.getElementById('testBtn').addEventListener('click', async function() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const idempotencyKey = document.getElementById('idempotencyKey').value.trim();
            const ttlSeconds = document.getElementById('ttlSeconds').value;

            const errorDiv = document.getElementById('testerError');
            const resultDiv = document.getElementById('testerResult');
            const loadingDiv = document.getElementById('testerLoading');

            errorDiv.style.display = 'none';
            resultDiv.style.display = 'none';
            loadingDiv.style.display = 'block';

            // Validation
            if (!apiKey) {
                errorDiv.textContent = 'API Key is required';
                errorDiv.style.display = 'block';
                loadingDiv.style.display = 'none';
                return;
            }
            if (!idempotencyKey) {
                errorDiv.textContent = 'Idempotency Key is required';
                errorDiv.style.display = 'block';
                loadingDiv.style.display = 'none';
                return;
            }

            try {
                const response = await fetch('http://144.24.119.46/api/idempotency/check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-KEY': apiKey
                    },
                    body: JSON.stringify({
                        idempotencyKey: idempotencyKey,
                        ttlSeconds: parseInt(ttlSeconds) || 3600
                    })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    errorDiv.textContent = `Error: ${data.message || data.error || 'Unknown error'}`;
                    errorDiv.style.display = 'block';
                } else {
                    document.getElementById('resultJson').textContent = JSON.stringify(data, null, 2);
                    resultDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = `Connection Error: ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                loadingDiv.style.display = 'none';
            }
        });

        // Copy result functionality
        document.getElementById('copyResultBtn').addEventListener('click', function() {
            const resultText = document.getElementById('resultJson').textContent;
            navigator.clipboard.writeText(resultText).then(() => {
                const originalText = this.textContent;
                this.textContent = 'Copied!';
                setTimeout(() => {
                    this.textContent = originalText;
                }, 2000);
            });
        });

        // Smooth scroll for nav links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // SPA Page Navigation
        document.querySelectorAll('.nav-link-sidebar').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const pageId = this.getAttribute('href').substring(1);
                showPage(pageId);
                
                // Close sidebar on mobile
                if (window.innerWidth < 992) {
                    document.getElementById('sidebar').classList.remove('active');
                }
            });
        });

        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            const activePage = document.querySelector(`[data-page="${pageId}"]`);
            if (activePage) {
                activePage.classList.add('active');
            }
            
            // Update active nav link
            document.querySelectorAll('.nav-link-sidebar').forEach(navLink => {
                navLink.classList.remove('active');
                if (navLink.getAttribute('href') === `#${pageId}`) {
                    navLink.classList.add('active');
                }
            });
            
            // Update URL hash
            history.pushState(null, '', `#${pageId}`);
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        // Load page from URL hash or show overview by default
        function loadPageFromHash() {
            const hash = window.location.hash.substring(1);
            if (hash && document.querySelector(`[data-page="${hash}"]`)) {
                showPage(hash);
            } else {
                showPage('overview');
            }
        }

        // Handle browser back/forward buttons
        window.addEventListener('popstate', loadPageFromHash);

        // Load initial page
        loadPageFromHash();

        // Sidebar toggle for mobile
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('active');
        });

        // Allow Enter key to trigger test
        document.getElementById('ttlSeconds').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('testBtn').click();
            }
        });

        document.getElementById('idempotencyKey').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('testBtn').click();
            }
        });
    </script>
</body>
</html>
